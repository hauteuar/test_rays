<!DOCTYPE html>
<html lang="en">
<head>
  <title>Admin</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/mobile.css">
  <link rel="stylesheet" href="/css/tab.css">
  <link rel="stylesheet" href="/css/calendar.css">
  <link rel="stylesheet" href="css/style22.css">
  <link rel="stylesheet" href="css/style2.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script src="components/topnav.js" type="text/javascript" defer></script>
  <script src="components/sidebar.js" type="text/javascript" defer></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.theme.min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.min.js"></script>
</head>

<body>
  <div class="container-scroller">
    <topnav-component></topnav-component>
    <div class="container-fluid page-body-wrapper">
      <sidebar-component data-page="advs_management"></sidebar-component>

      <div class="main-section">
        <div class="flex-align mt-3" style="flex-wrap: wrap; row-gap: 20px;">
          <div>
            <h5 class="font-weight-400 text-gray">Sponsors <span id="sponsor-count" class="text-dark font-weight-50">0</span></h5>
            <h5 class="mt-3">You can rearrange the sponsor ads by clicking and dragging.</h5>
          </div>
          <div class="flex-align3 g2" style="flex-wrap:wrap;">
            <a class="btn btn-outline-ramblers g2 px-3" data-bs-toggle="modal" data-bs-target="#setTime">
              <img src="images/clock-red.png" style="width: 16px;">
              Set Time
            </a>
            <a class="btn btn-ramblers" data-bs-toggle="modal" data-bs-target="#addSponsors">
              + Add Sponsors
            </a>
          </div>
        </div>
        <div class="row my-3">
          <div class="w-100p-450px">
            <div class="sponsors-cards" id="sponsors-list">
              <!-- Sponsor cards will be dynamically inserted here -->
            </div>
          </div>
          <div class="w-450px">
            <h5 class="font-weight-600">Sponsors logo in mobile</h5>
            <div class="mob-screen mt-5">
              <img src="images/mob-mockup.png" class="mob-mockup">
              <div class="mob-screen-container">
                <div class="flex-align g2 pt-4 px-4">
                  <img src="images/ramblers-text.png" id="mobile-logo" style="width: 120px;">
                  <div class="flex-align3 g3">
                    <img src="images/chat.png" style="width: 20px;">
                    <img src="images/bell.png" style="width: 20px;">
                  </div>
                </div>
                <div class="mob-body">
                  <h6 class="font-weight-400 text-gray mb-3">Sponsors</h6>
                  <div id="sponsor-carousel" class="owl-carousel">
                    <!-- Dynamic sponsor logos will be inserted here -->
                  </div>
                  <div id="tiles-section" class="mt-4">
                    <!-- Tiles for courses, coaches, students, packages -->
                    <div class="row" style="row-gap: 20px;">
                      <div class="col-6">
                        <div class="card mockup-card">
                          <div class="mob-card-img">
                            <img src="images/courses.png" alt="Courses">
                          </div>
                          <h6 class="font-weight-600 mt-1 text-center">Courses</h6>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="card mockup-card">
                          <div class="mob-card-img">
                            <img src="images/coaches.png" alt="Coaches">
                          </div>
                          <h6 class="font-weight-600 mt-1 text-center">Coaches</h6>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="card mockup-card">
                          <div class="mob-card-img">
                            <img src="images/user-dp.png" alt="Students">
                          </div>
                          <h6 class="font-weight-600 mt-1 text-center">Students</h6>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="card mockup-card">
                          <div class="mob-card-img">
                            <img src="images/club-documents.png" alt="Packages">
                          </div>
                          <h6 class="font-weight-600 mt-1 text-center">Packages</h6>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mob-footer">
                  <div class="row">
                    <div class="col-3">
                      <img src="images/home.png">
                      <h6 class="font-weight-600">Home</h6>
                    </div>
                    <div class="col-3">
                      <img src="images/Events.png">
                      <h6>Events & News</h6>
                    </div>
                    <div class="col-3">
                      <img src="images/Ecommerse.png">
                      <h6>Ecommerce</h6>
                    </div>
                    <div class="col-3">
                      <img src="images/profile.png">
                      <h6>Profile</h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Sponsor Modal -->
      <div class="modal fade" id="addSponsors" tabindex="-1" aria-labelledby="addSponsorsLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-md">
          <div class="modal-content">
            <div class="modal-body p-4">
              <div class="flex-align modal-head2 pb-4 border-bottom">
                <h3>Add Sponsor</h3>
                <img src="images/close.png" data-bs-dismiss="modal" style="cursor: pointer;width: 20px;height: 20px;">
              </div>
              <div class="modal-body2 p-md-3 p-0">
                <div class="row mt-3" style="row-gap: 20px;">
                  <div class="col-lg-4 col-md-6 col-item" style="padding-right: 20px;">
                    <h5 class="font-weight-500 mb-2">Sponsor Logo</h5>
                    <div class="image-picker image-picker2" style="height: 150px;">
                      <input type="file" id="sponsorLogo" accept="image/*" class="input w-100">
                      <div class="image-picker-tab">
                        <img src="images/upload3.png">
                        Upload image
                      </div>
                    </div>
                  </div>
                  <div class="col-md-12 col-item">
                    <div class="mb-4">
                      <h5 class="font-weight-500 mb-2">Sponsor Name</h5>
                      <input type="text" id="sponsorName" class="input w-100" placeholder="Enter sponsor name">
                    </div>
                    <div class="mb-4">
                      <h5 class="font-weight-500 mb-2">Sponsor Web Address</h5>
                      <input type="text" id="sponsorWebAddress" class="input w-100" placeholder="Enter web address">
                    </div>
                    <label class="flex-align3 g2 mt-4">
                      <input id="highlightSponsor" type="checkbox" style="accent-color: red;">
                      <h5 class="font-weight-600 text-dark">Highlight sponsor</h5>
                    </label>
                  </div>
                </div>
                <div class="modal-footer2 d-flex justify-content-end g2 mt-5">
                  <button type="button" class="btn btn-ramblers px-4" onclick="saveSponsor()">Save</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Set Time Modal -->
      <div class="modal fade" id="setTime" tabindex="-1" aria-labelledby="setTimeLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
          <div class="modal-content">
            <div class="modal-body p-4">
              <div class="flex-align modal-head2 pb-4 border-bottom">
                <h3>Set time</h3>
                <img src="images/close.png" data-bs-dismiss="modal" style="cursor: pointer;width: 20px;height: 20px;">
              </div>
              <div class="modal-body2 py-4">
                <div class="flex-align3 g2">
                  <h4 class="font-weight-500">Auto slide</h4>
                  <div class="toggle-tab-container3 toggle">
                    <input type="checkbox" id="autoSlide">
                    <span class="toggle-bar"></span>
                  </div>
                </div>
                <div class="flex-align3 g4 my-4">
                  <label for="right" class="flex-align3 g1 cursor-pointer">
                    <input id="right" type="radio" name="slideDirection" checked style="accent-color: #c3282e; width: 18px; height: 18px;">
                    <h4 class="font-weight-500">Slide right to left</h4>
                  </label>
                  <label for="left" class="flex-align3 g1 cursor-pointer">
                    <input id="left" type="radio" name="slideDirection" style="accent-color: #c3282e; width: 18px; height: 18px;">
                    <h4 class="font-weight-500">Slide left to right</h4>
                  </label>
                </div>
                <div class="py-3">
                  <h4>Slide speed</h4>
                  <div class="button-tabs g1 flex-align3 mt-3" style="flex-wrap: wrap;">
                    <button class="btn btn-outline-danger" style="min-width: 80px;" onclick="setSlideSpeed('slow')">Slow</button>
                    <button class="btn btn-outline-danger active-btn-danger" style="min-width: 80px;" onclick="setSlideSpeed('medium')">Medium</button>
                    <button class="btn btn-outline-danger" style="min-width: 80px;" onclick="setSlideSpeed('fast')">Fast</button>
                  </div>
                </div>
                <div class="py-3">
                  <h4>Ad display time</h4>
                  <div class="input-with-btn flex-align3 mt-3">
                    <input type="text" id="adDisplayTime" value="5" class="input w-100">
                    <div style="position: absolute;right: 0; display: flex;">
                      <div class="btn btn-outline-danger active-btn-danger px-3" style="border-top-right-radius: 0; border-bottom-right-radius: 0; height: 38px;">Sec</div>
                      <div class="btn" onclick="setDisplayTime('min')">Min</div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer2 d-flex justify-content-center g2 mt-4">
                  <button type="button" class="btn btn-ramblers px-4" onclick="saveTimeSettings()">Save</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="js/off-canvas.js"></script>
  <script src="js/template.js"></script>
  <script>
    async function saveSponsor() {
      const organizationId = localStorage.getItem('organizationId');
      const token = localStorage.getItem('token');
      const sponsorLogo = document.getElementById('sponsorLogo').files[0];
      const sponsorName = document.getElementById('sponsorName').value;
      const sponsorWebAddress = document.getElementById('sponsorWebAddress').value;
      const highlightSponsor = document.getElementById('highlightSponsor').checked;

      if (!sponsorLogo || !sponsorName || !sponsorWebAddress) {
        alert('Please fill in all required fields.');
        return;
      }

      const formData = new FormData();
      formData.append('imageUrl', sponsorLogo); // Changed to match multer field name
      formData.append('name', sponsorName);
      formData.append('webAddress', sponsorWebAddress);
      formData.append('highlight', highlightSponsor);

      try {
        const response = await fetch(`/api/sponsors/${organizationId}/sponsors`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });

        if (response.ok) {
          $('#addSponsors').modal('hide');
          fetchSponsors();
          
          location.reload();
        } else {
          const errorData = await response.json();
          alert('Failed to save sponsor: ' + errorData.message);
        }
      } catch (error) {
        console.error('Error saving sponsor:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const organizationId = localStorage.getItem('organizationId');
      const token = localStorage.getItem('token');

      // Fetch sponsors and render them
      async function fetchSponsors() {
        try {
          const response = await fetch(`/api/sponsors/${organizationId}/sponsors`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          const data = await response.json();
          if (data.success) {
            renderSponsors(data.sponsors);
            document.getElementById('sponsor-count').textContent = data.sponsors.length;
          } else {
            console.error('Failed to load sponsors');
          }
        } catch (error) {
          console.error('Error fetching sponsors:', error);
        }
      }

      // Render sponsors
      function renderSponsors(sponsors) {
        const sponsorsList = document.getElementById('sponsors-list');
        const sponsorCarousel = document.getElementById('sponsor-carousel');
        sponsorsList.innerHTML = '';
        sponsorCarousel.innerHTML = '';

        sponsors.forEach((sponsor, index) => {
          const sponsorCard = document.createElement('div');
          sponsorCard.classList.add('sponsors-cards-child', 'flex-align3', 'g3', 'mb-2');
          sponsorCard.setAttribute('data-id', sponsor._id);
          sponsorCard.innerHTML = `
            <span>${index + 1}</span>
            <div class="sponsors-card flex-align3 g4 w-100 border rounded p-3 pe-4">
              <div class="flex-align3 g3 pe-4 mr-3" style="border-right: 1px solid #1111114D;">
                <img src="images/menu2.png" style="width: 20px;">
                <img src="${sponsor.logoUrl}" style="width: 90px; height:70px;">
              </div>
              <div class="flex-align g2 w-100">
                <div>
                  <h6 class="font-weight-500">${sponsor.name}</h6>
                  <h6 class="text-gray mt-2">${sponsor.webAddress}</h6>
                </div>
                <div class="dropdown">
                  <img src="images/dots.png" class="dropdown-toggle" type="button" data-bs-toggle="dropdown" style="width:15px;height: 15px;object-fit: contain;" aria-expanded="false">
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item">Edit</a></li>
                    <li><a class="dropdown-item" href="#" onclick="deleteSponsor('${sponsor._id}')">Delete</a></li>
                  </ul>
                </div>
              </div>
            </div>
          `;
          sponsorsList.appendChild(sponsorCard);

          const sponsorLogoElement = document.createElement('div');
          sponsorLogoElement.classList.add('item');
          sponsorLogoElement.innerHTML = `<img src="${sponsor.logoUrl}" alt="${sponsor.name}" style="width: 100%; height: auto; max-width: 80px; margin: 0 auto;">`;
          sponsorCarousel.appendChild(sponsorLogoElement);
        });

        // Initialize or reinitialize the Owl Carousel
        $("#sponsor-carousel").owlCarousel({
          items: 3,
          pagination: true,
          navigation: false,
          autoPlay: true,
          slideSpeed: 300,
          paginationSpeed: 400,
          rewindSpeed: 500,
          loop: true
        });
      }

      // Delete sponsor
      async function deleteSponsor(sponsorId) {
        if (!confirm('Are you sure you want to delete this sponsor?')) return;

        try {
          const response = await fetch(`/api/sponsors/${sponsorId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          if (response.ok) {
            fetchSponsors();
            location.reload();
          } else {
            alert('Failed to delete sponsor.');
          }
        } catch (error) {
          console.error('Error deleting sponsor:', error);
        }
      }

      // Initialize drag and drop for reordering
      $("#sponsors-list").sortable({
        update: function(event, ui) {
          const reorderedSponsors = [];
          $("#sponsors-list .sponsors-cards-child").each(function(index, element) {
            reorderedSponsors.push({
              _id: element.getAttribute('data-id'),
              displayOrder: index + 1
            });
          });
          reorderSponsors(reorderedSponsors);
        }
      });

      // Reorder sponsors on the server
      async function reorderSponsors(sponsors) {
        try {
          await fetch(`/api/sponsors/${organizationId}/sponsors/reorder`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ sponsors })
          });
          fetchSponsors();
          location.reload();
        } catch (error) {
          console.error('Error reordering sponsors:', error);
        }
      }

      // Fetch sponsors on page load
      fetchSponsors();
    });
  </script>

  <script src="js/script.js"></script>
  <script type="text/javascript">
    $(document).ready(function(){
      $("#banner-slider").owlCarousel({
        items:1,
        pagination:true,
        navigation:false,
        autoPlay:true
      });
    });
  </script>


    <script> document.addEventListener('DOMContentLoaded', async () => {
      const organizationId = localStorage.getItem('organizationId');
      const token = localStorage.getItem('token');
    
      try {
        // Fetch and apply organization logo
        const logoResponse = await fetch(`/api/organizations/${organizationId}/logo`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'organizationId': organizationId,
          }
        });
        const logoData = await logoResponse.json();
        if (logoData.logo_url) {
          const logoImg = document.querySelector('.mob-screen-container img[src="images/ramblers-text.png"]');
          if (logoImg) {
            logoImg.src = logoData.logo_url;
          }
        }
    
        // Fetch and apply organization theme color
        const themeResponse = await fetch(`/api/organizations/${organizationId}/theme`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        const themeData = await themeResponse.json();

    
        if (themeData && themeData.theme_color) {
          console.log('Fetched theme color:', themeData.theme_color);  // Debugging: Log the fetched color
          const mobileScreenContainer = document.querySelector('.mob-screen-container');
          if (mobileScreenContainer) {
            mobileScreenContainer.style.backgroundColor = themeData.theme_color;
            console.log('Applied theme color to mobile screen container');
          } else {
            console.error('Mobile screen container not found');
          }
        } else {
          console.error('Theme color not found in API response');
        }
      } catch (error) {
        console.error('Error fetching organization data:', error);
      }
    });
    
</script>
</body>

</html> 